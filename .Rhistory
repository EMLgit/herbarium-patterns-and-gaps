library(plotly)
library(webr) #likely delete this package
install.packages("webr")
library(webr) #likely delete this package
load(file="Data_both-allandgeo.RData")
load(file="basicDataStack_simple_withNMRPlist.Rdata")
load(file="/Users/elizabethlombardi/Downloads/basicDataStack_simple_withNMRPlist.Rdata")
dat<-df2
library(ggplot2)
library(dplyr)
library(khroma)
library(ggpubr)
fams <- dat %>%
group_by(Accepted_family) %>%
filter(!Accepted_family=="") %>%
count(sort=TRUE)
gens <- dat %>%
group_by(Genus_matched) %>%
filter(!Genus_matched=="") %>%
count(sort=TRUE)
spp <- dat %>%
group_by(Accepted_name) %>%
filter(!Accepted_name=="") %>%
count(sort=TRUE)
##How many unique families, genera and species are in the database?
length(unique(fams$Accepted_family)) #167
length(unique(gens$Genus_matched)) #1688
length(unique(spp$Accepted_name)) #7210
#species diversity
spp <- dat %>%
group_by(Accepted_name) %>%
filter(!Accepted_name == "") %>% #there are 2398 records without species epithet
dplyr::summarise(count = n())
library(plotly)
#library(webr) #likely delete this package
library(ggplot2)
library(dplyr)
library(khroma)
library(ggpubr)
fig1<-dat %>%group_by(year)%>%tally(sort=TRUE)%>%na.omit()
mean(fig1$n)
IQR(fig1$n)
View(fig1)
hist(fig1$n)
median(fig1$n)
library(terra)
library(maps)
library(sf)
library(ggplot2)
library(ggmap)
library(ggalt)
install.packages("ggalt")
library(ggalt)
library(ggsn)
install.packages("ggsn")
#library(ggsn) not available for current R version
library(ggspatial)
#prepare bounding box for north america base map
north_america_bbox <- c(-127, 14, -52, 55)
# Set up the Molleweide projection
target_crs <- st_crs("+proj=moll +x_0=0 +y_0=0 +lat_0=0 +lon_0=133")
if (require("maps")) {
usa <- map_data("usa", interior=FALSE)
nm <- map_data("state", region="new mexico")
canada <- map_data("world", region="Canada")
mexico <- map_data("world", region="Mexico")
alaska <- map_data("world", region="USA:Alaska")
alaska <-subset(alaska,long<0) #drop the Aleutian islands
# Prepare a map of USA
NAmap <- ggplot() + geom_polygon(data = usa,
aes(x=long, y = lat, group = group),
fill = "white",
color="black",
size=.4) +
geom_polygon(data = canada, aes(x=long, y = lat, group = group),
fill = "white", color="black", size=.1) +
geom_polygon(data = mexico, aes(x=long, y = lat, group = group),
fill = "white", color="black", size=.4) +
geom_polygon(data = alaska, aes(x=long, y = lat, group = group),
fill = "white", color="black", size=.05) +
geom_polygon(data = nm, aes(x=long, y = lat, group = group), fill = "black", color = "black", size=.3, alpha=.7) +
#coord_sf(xlim = c(-125, -70),  ylim = c(20, 52), crs = st_crs(4326), datum = st_crs(4326)) +
coord_sf(xlim = c(-125, -100),  ylim = c(23, 45), crs = st_crs(4326), datum = st_crs(4326)) +
labs(x = "Longitude",
y = "Latitude") +
annotation_north_arrow(location = "bl", which_north = "true", style = north_arrow_fancy_orienteering,
pad_x = unit(0.25, "in"), pad_y = unit(0.25, "in")) +
annotation_scale(location = 'bl', width_hint = 0.15) +
theme_bw()
# Plot it in cartesian coordinates
NAmap
}
# Prepare a map of USA
NAmap <- ggplot() + geom_polygon(data = usa,
aes(x=long, y = lat, group = group),
fill = "white",
color="black",
size=.4) +
geom_polygon(data = canada, aes(x=long, y = lat, group = group),
fill = "white", color="black", linewidth=.1) +
geom_polygon(data = mexico, aes(x=long, y = lat, group = group),
fill = "white", color="black", linewidth=.4) +
geom_polygon(data = alaska, aes(x=long, y = lat, group = group),
fill = "white", color="black", linewidth=.05) +
geom_polygon(data = nm, aes(x=long, y = lat, group = group), fill = "black", color = "black", size=.3, alpha=.7) +
#coord_sf(xlim = c(-125, -70),  ylim = c(20, 52), crs = st_crs(4326), datum = st_crs(4326)) +
coord_sf(xlim = c(-125, -100),  ylim = c(23, 45), crs = st_crs(4326), datum = st_crs(4326)) +
labs(x = "Longitude",
y = "Latitude") +
annotation_north_arrow(location = "bl", which_north = "true", style = north_arrow_fancy_orienteering,
pad_x = unit(0.25, "in"), pad_y = unit(0.25, "in")) +
annotation_scale(location = 'bl', width_hint = 0.15) +
theme_bw()
# Plot it in cartesian coordinates
NAmap
##Ecoreg3
eco1 <- env.v %>%
filter(!ecoreg3=="") %>%
filter(!year>2023) %>%
mutate_at(c('ecoreg3.area'), as.numeric) %>%
group_by(ecoreg3, ecoreg3.area, year) %>%
summarise(cnt = n()) %>%
mutate(freq = round(cnt / sum(cnt), 3)) %>%
arrange(desc(freq))
eco3.hist<-ggplot(eco1, aes(x=as.numeric(year), color=ecoreg3)) +
geom_freqpoly(binwidth=5, alpha=0.8) +
scale_fill_smoothrainbow(discrete=TRUE) +
theme(legend.position = "right")
eco3.hist
#Ecoreg4
eco2 <- env.v %>%
filter(!ecoreg4=="") %>%
filter(!year>2023) %>%
mutate_at(c('ecoreg4.area'), as.numeric) %>%
group_by(ecoreg4, ecoreg4.area, year) %>%
summarise(cnt = n()) %>%
mutate(freq = round(cnt / sum(cnt), 3)) %>%
arrange(desc(freq))
